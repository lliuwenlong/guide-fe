# 发行

该目录存放经过优化需求评审后落实的《优化需求文档》，是可以进行实施的具体方案。故定义为该优化建议的发行阶段。

# 最佳实践第一期

## 1. 使用 `moment.js` 来处理日期格式

### 原因

编辑器目前针对日期的使用场景较多且分散，如卡点时间、播放器时间轴部分的的时间等，而且在对这些时间数据的处理上没有一个统一的工具类，同样的方法在很多文件中都有。 不方便日后的维护及扩展工作，使用 `moment.js` 等时间格式的处理类库可以很方便的解决这些问题。

### 解决方案

可以通过对以往时间数据的使用格式进行分析，然后使用 `moment.js` 中对应的 `api` 来封装成一个统一的工具方法，在使用的地方引入这个工具类。

### 影响范围

卡点、视频播放器进度条、输出的课件内容

## 2. 整合挂载在 `window` 上的全局变量

### 原因

 以前为了使用方便很多跨文件的变量都是直接挂载在window上来管理，这样虽然使用起来很方便，但是其实危险系数也很高，如用户可以通过将 `window.globalVars.isManaualSave` 设置为 `false` 来逃过手动保存课件时的质检环节，最终产出的课件内容无法得到有效的保障，对后续的工作会带来很多负面的影响。 

### 解决方案

创建单例 `PhoenixData`, 将所有的全局变量集中管理。为以后去掉全局变量做准备。
 ```
  class PhoenixData {
    constructor() {
      this.allPaths = {
        rootPath: '',
        coursewarePath: '',
        dataPath: ''
      }
      // 其他属性 。。。。
    }
  }
  const phoenixData = new PhoenixData();
  window.phoenixData = phoenixData;
  export default phoenixData;
 ```
 
 设值
 ```
  import phoenixData from '../utils/PhoenixData';
  // ...
  phoenixData.allPaths.rootPath = './nnn';
 ```

 取值
 ```
  import phoenixData from '../utils/PhoenixData'
  // ...
  let path = phoenixData.allPaths.rootPath;
 ```

 ### 影响范围

 所有涉及到全局变量的功能。

 ## 3. 接口错误数据的处理

 ### 原因

* 增加对项目错误情况的反馈
* 避免对错误数据进行处理时的语法错误

### 解决方案

* 针对返回数据是否存在进行判断
* 针对返回数据的code是否为0进行判断
* 针对返回数据中是否存在我们需要的数据进行判断

### 案例

http://zentao.100tal.com/pro/bug-view-93034.html

### 影响范围

* 所有的后端接口调用
* 所有C++接口调用
* 所有组件相关接口调用

## 4. 清理无用的代码

### 原因

无用代码的存在会加大我们理解程序的难度，也会增加很多的安全风险。移除无用代码并非是一个技术问题，而是一种理念上的和文化上的问题。

### 解决方案

`Find it, remove it !`

注意： 在移除某个代码块时，一定要先全局检索是否有对其的引用。

### 影响范围

整个项目。

尽量通过全局搜索移除的代码，来减少影响范围。

## 5. 按照日志规范，修改项目中的日志打印

### 原因

系统上线之后，一旦发生异常，第一件事就是要弄清楚当时发生了什么，用户当时做了什么操作，环境有无影响，数据有什么变化，是不是反复发生等，然后再进一步的确定大致是哪个方面的问题。这时，日志就给我们提供了第一手的资料。
而目前项目中的日志打印没有任何规范，在排查问题时根据日志难以定位问题。

### 解决方案

* 不影响系统正常运行；

* 不允许产生安全问题；

* 不允许输出机密信息；

* 日志可供开发人员定位问题的真正原因；

* 日志可供监控系统自动监控与分析；

使用[新象老师的日志规范](http://pxwiki.facethink.com/confluence/pages/viewpage.action?pageId=234395268)来改造编辑器中的日志打印。

### 影响范围

整个项目的日志打印。不会有功能上的影响。